<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//Norman Walsh//DTD DocBk XML V5.0//EN"
 "/usr/share/xml/docbook5/schema/dtd/5.0/docbook.dtd">

<book xmlns='http://docbook.org/ns/docbook'>
<title>Arachne - Administrator's Guide</title>
<titleabbrev>Arachne</titleabbrev>
<info>
  <legalnotice><para>No notice is required.</para></legalnotice>
  <author><personname>
    <firstname>Claas</firstname><surname>Nieslony</surname>
  </personname></author>
</info>
<dedication>
<para>This book is dedicated to you.
</para>
</dedication>
<preface><title>Foreword</title>
<para>Some content is always required.
</para>
</preface>

<chapter>
    <title>Installation</title>
    <section>
        <title>CentOS 7</title>
        <orderedlist>
            <listitem>
                <para>Add arache repository</para>
                <programlisting>
                    wget http://download.opensuse.org/repositories/home:/nieslony/CentOS_7/home:nieslony.repo -C /etc/yum.repos.d
                </programlisting>
            </listitem>
            <listitem>
                <para>Add EPEL repository</para>
                <programlisting>
                    yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
                </programlisting>
            </listitem>
            <listitem>
                <para>Install packages</para>
                <programlisting>
                    yum install arachne-server arachne postgres-server
                </programlisting>
            </listitem>
        </orderedlist>
    </section>
    <section>
        <title>openSUSE</title>
        <orderedlist>
            <listitem>
                <para>Add arachne repository</para>
                <programlisting>
                    zypper ar http://download.opensuse.org/repositories/home:/nieslony/openSUSE_Leap_42.2/
                </programlisting>
            </listitem>
            <listitem>
                <para>Install packages</para>
                <programlisting>
                    zypper install arachne-server postgresql-server
                </programlisting>
            </listitem>
        </orderedlist>
    </section>
</chapter>

<chapter>
    <title>Initial setup</title>
    <para>
        In the following steps replace arachne.example.com with your arachne server's full
        qualified domain name.
    </para>
    <orderedlist>
        <listitem>
            <para>Start Tomcat server</para>
            <programlisting>
                systemctl start tomcat
            </programlisting>
        </listitem>
        <listitem>
            <para>Open arachne in Mozilla Firefox or in your favorite web browser.</para>
            <programlisting>
                firefox http://arachne.example.com:8080/arachne
            </programlisting>
            <para>You will see arachne's setup wizard</para>
        </listitem>
        <listitem>
            <para>Enjoy arachne setups wizard's welcome page</para>
            <screenshot>
                <screeninfo>Setup wizard - welcome</screeninfo>
                <mediaobject>
                    <imageobject>
                    <imagedata fileref="pics/SetupWizard_Welcome.png" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </screenshot>
        </listitem>
        <listitem>
            <para>Set name of master adminitrative user and password.</para>
            <screenshot>
                <screeninfo>Setup wizard - create admin user</screeninfo>
                <mediaobject>
                    <imageobject>
                    <imagedata fileref="pics/SetupWizard_CreateAdmin.png" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </screenshot>
        </listitem>
        <listitem>
            <para>
                Create a self signed CA, that will create certificates for the 
                openvpn server and VPN users.
            </para>
            <screenshot>
                <screeninfo>Setup wizard - create self signed CA</screeninfo>
                <mediaobject>
                    <imageobject>
                    <imagedata fileref="pics/SetupWizard_CreateSelfSignedCa.png" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </screenshot>
        </listitem>
        <listitem>
            <para>
                Create openvpn server certificate. The common name must be the 
                full qualified domain name (FQDN) of your openvpn server as 
                visible from the internet.
            </para>
            <screenshot>
                <screeninfo>Setup wizard - create server certificate</screeninfo>
                <mediaobject>
                    <imageobject>
                    <imagedata fileref="pics/SetupWozard_CreateServerCertificate.png" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </screenshot>
        </listitem>
        <listitem>
            <para>
                Arachne stores its settings and certificate in a postgresql 
                database. Set username etc. here. 
            </para>
            <screenshot>
                <screeninfo>Setup wizard - create self signed CA</screeninfo>
                <mediaobject>
                    <imageobject>
                    <imagedata fileref="pics/SetupWizard_Database.png" format="PNG"/>
                    </imageobject>
                </mediaobject>
            </screenshot>
            <para>
                You can download a SQL file that contains everything to create a database user and an empty database. A hash of the password you entered here is included.
            </para>
            <para>
                To enable md5 authentication on your postgres server, add the following line to /var/lib/pgsql/data/pg_hba.conf:
            </para>
            <programlisting>
                  host    openvpnadmin     openvpnadmin     127.0.0.1/32    md5
            </programlisting>
            <para>
                You can test the database connectivity by clicking "Test connection".
            </para>
        </listitem>
        <listitem>
            <para>
                To finalize setup click "finish" on the last page. Arachne will 
                create the administrator user, your CA, a server certificate, 
                DH paramerts and all neccary database tables and initial values.
            </para>
            <para>
                This step takes a coupleof minutes.
            </para>
        </listitem>
    </orderedlist>
</chapter>

<appendix><title>Optional Appendix</title>
<para>Appendixes are optional.
</para>
</appendix>
</book>
